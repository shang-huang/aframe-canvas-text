!function(){"use strict";if("undefined"==typeof AFRAME)throw new Error("Canvas-text need AFRAME to work.");AFRAME.registerComponent("canvas-text",{schema:{value:{type:"string"},size:{type:"int",default:50},color:{type:"color",default:"black"},align:{type:"string",default:"left",oneOf:["left","center","right"]}},init:function(){this.canvas=document.createElement("canvas"),this.canvas.id=this.el.object3D.uuid,this.canvas.style.display="none",this.el.appendChild(this.canvas),this.context=this.canvas.getContext("2d")},update:function(e){if(e!=this.data){let e=this.el,t=this.canvas,i=this.context,n=window.devicePixelRatio,l=window.getComputedStyle(document.body,null).getPropertyValue("font-family"),a=this.data.size*n+"px "+l,s=this.data.value.split("\\u"),o="";s.forEach((e,t)=>{if(0===t)o+=e;else{let i=this.getUnicodeCharFromSentence(e,5);if(/[\u{10000}-\u{2ffff}]/u.test(i))o+=i+e.substring(5,s[t].length);else{let i=this.getUnicodeCharFromSentence(e,4);/[\u{0000}-\u{ffff}]/u.test(i)?o+=i+e.substring(4,s[t].length):o+=e}}});let r=o.replace(/\\n/g,"\n").split("\n"),c=document.createElement("div");c.style.display="inline-block",r.forEach(e=>{let t=document.createElement("span");t.style.font=a,t.innerText=e,c.appendChild(t);let i=document.createElement("br");i.style.lineHeight=0,c.appendChild(i)}),document.body.appendChild(c);let d=c.offsetWidth,h=c.offsetHeight,f=[];c.childNodes.forEach(e=>{"span"===e.nodeName.toLowerCase()&&f.push(e.offsetHeight)}),document.body.removeChild(c),t.width=d,t.height=h,i.clearRect(0,0,d,h),i.font=a,i.textBaseline="middle",i.fillStyle=this.data.color;let u=0;r.forEach((e,t)=>{let n=f[t]/2+u;switch(this.data.align){case"left":i.textAlign="left",i.fillText(e,0,n);break;case"center":i.textAlign="center",i.fillText(e,d/2,n);break;case"right":i.textAlign="right",i.fillText(e,d,n);break;default:i.textAlign="left",i.fillText(e,0,n)}u+=f[t]});let g=.0075/n;e.setAttribute("geometry",{primitive:"plane",width:d*g,height:h*g}),e.removeAttribute("material"),e.setAttribute("material",{src:"#"+t.id.toString(),shader:"flat",npot:1,transparent:1})}},remove:function(){this.el.innerHTML=""},getUnicodeCharFromSentence:function(e,t){return String.fromCodePoint(parseInt(e.substring(0,t),16))}})}();
