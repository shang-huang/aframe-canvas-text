!function(){"use strict";if("undefined"==typeof AFRAME)throw new Error("Canvas-text need AFRAME to work.");function e(e,t){return String.fromCodePoint(parseInt(e.substring(0,t),16))}AFRAME.registerComponent("canvas-text",{schema:{value:{type:"string"},size:{type:"int",default:50},color:{type:"color",default:"black"},align:{type:"string",default:"left",oneOf:["left","center","right"]}},init(){this.canvas=document.createElement("canvas"),this.canvas.id=this.el.object3D.uuid,this.canvas.style.display="none",this.el.appendChild(this.canvas),this.context=this.canvas.getContext("2d")},update:function(e){e!=this.data&&this.draw()},draw(){let t=this.data,i=this.el,n=this.canvas,l=this.context,a=window.devicePixelRatio,r=window.getComputedStyle(document.body,null).getPropertyValue("font-family"),s=`${t.size*a}px ${r}`,o=function(t){let i=t.split("\\u"),n="";return i.forEach((t,l)=>{if(0===l)n+=t;else{let a=e(t,5);if(/[\u{10000}-\u{2ffff}]/u.test(a))n+=a+t.substring(5,i[l].length);else{let a=e(t,4);/[\u{0000}-\u{ffff}]/u.test(a)?n+=a+t.substring(4,i[l].length):n+=t}}}),n}(t.value).replace(/\\n/g,"\n").split("\n"),c=document.createElement("div");c.style.display="inline-block",o.forEach(e=>{let t=document.createElement("span");t.style.font=s,t.innerText=e,c.appendChild(t);let i=document.createElement("br");i.style.lineHeight=0,c.appendChild(i)}),i.appendChild(c);let d=c.offsetWidth,f=c.offsetHeight,h=[];c.childNodes.forEach(e=>"span"===e.nodeName.toLowerCase()&&h.push(e.offsetHeight)),i.removeChild(c),n.width=d,n.height=f,l.clearRect(0,0,d,f),l.font=s,l.textBaseline="middle",l.fillStyle=t.color;let u=0;o.forEach((e,i)=>{let n=h[i]/2+u;switch(t.align){case"left":l.textAlign="left",l.fillText(e,0,n);break;case"center":l.textAlign="center",l.fillText(e,d/2,n);break;case"right":l.textAlign="right",l.fillText(e,d,n);break;default:l.textAlign="left",l.fillText(e,0,n)}u+=h[i]});let p=.0075/a;i.hasAttribute("geometry")&&i.removeAttribute("geometry"),i.setAttribute("geometry",{primitive:"plane",width:d*p,height:f*p}),i.hasAttribute("material")&&i.removeAttribute("material"),i.setAttribute("material",{src:`#${n.id}`,shader:"flat",npot:!0,transparent:!0})},remove(){this.el.innerHTML=""}})}();
