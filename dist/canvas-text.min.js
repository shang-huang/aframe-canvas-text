(function(){'use strict';if("undefined"==typeof AFRAME)throw new Error("Canvas-text need AFRAME to work.");AFRAME.registerComponent("canvas-text",{schema:{value:{type:"string"},size:{type:"int",default:50},color:{type:"color",default:"black"}},init:function(){this.canvas=document.createElement("canvas"),this.canvas.id=this.el.object3D.uuid,this.canvas.style.display="none",this.el.appendChild(this.canvas),this.context=this.canvas.getContext("2d")},update:function(a){if(a!=this.data){let a=window.devicePixelRatio,b=window.getComputedStyle(document.body,null).getPropertyValue("font-family"),c=this.data.size*a+"px "+b,d=this.data.value.replace(/\\n/g,"\n"),e=d.split("\n"),f=document.createElement("div");f.style.display="inline-block",e.forEach(a=>{let b=document.createElement("span");b.style.font=c,b.innerText=a,f.appendChild(b);let d=document.createElement("br");d.style.lineHeight=0,f.appendChild(d)}),document.body.appendChild(f);let g=f.offsetWidth,h=f.offsetHeight,i=[];f.childNodes.forEach(a=>{"span"===a.nodeName.toLowerCase()&&i.push(a.offsetHeight)}),document.body.removeChild(f),this.canvas.width=g,this.canvas.height=h,this.context.clearRect(0,0,g,h),this.context.font=c,this.context.textBaseline="middle",this.context.fillStyle=this.data.color;let j=0,k=0;e.forEach(a=>{this.context.fillText(a,0,i[j]/2+k),k+=i[j],j++});let l=.0075/a;this.el.setAttribute("geometry",{primitive:"plane",width:g*l,height:h*l}),this.el.removeAttribute("material"),this.el.setAttribute("material",{src:"#"+this.canvas.id.toString(),shader:"flat",npot:!0,transparent:!0})}},remove:function(){this.el.innerHTML=""}})})();
