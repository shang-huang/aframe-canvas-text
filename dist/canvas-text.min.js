(function(){'use strict';if("undefined"==typeof AFRAME)throw new Error("Canvas-text need AFRAME to work.");AFRAME.registerComponent("canvas-text",{schema:{value:{type:"string"},size:{type:"int",default:50},color:{type:"color",default:"black"}},init:function(){this.canvas=document.createElement("canvas"),this.canvas.id=this.el.object3D.uuid,this.canvas.style.display="none",this.el.appendChild(this.canvas),this.context=this.canvas.getContext("2d")},update:function(a){if(a!=this.data){let a=window.devicePixelRatio,c=window.getComputedStyle(document.body,null).getPropertyValue("font-family"),d=this.data.size*a+"px "+c,e=this.data.value.split("\\u"),f="";for(var b=1;b<e.length;b++){let a=e[b].substring(0,4),c=String.fromCharCode(parseInt(a,16))+e[b].substring(4,e[b].length);f+=c}let g=e[0]+f.replace(/\\n/g,"\n"),h=g.split("\n"),i=document.createElement("div");i.style.display="inline-block",h.forEach(a=>{let b=document.createElement("span");b.style.font=d,b.innerText=a,i.appendChild(b);let c=document.createElement("br");c.style.lineHeight=0,i.appendChild(c)}),document.body.appendChild(i);let j=i.offsetWidth,k=i.offsetHeight,l=[];i.childNodes.forEach(a=>{"span"===a.nodeName.toLowerCase()&&l.push(a.offsetHeight)}),document.body.removeChild(i),this.canvas.width=j,this.canvas.height=k,this.context.clearRect(0,0,j,k),this.context.font=d,this.context.textBaseline="middle",this.context.fillStyle=this.data.color;let m=0,n=0;h.forEach(a=>{this.context.fillText(a,0,l[m]/2+n),n+=l[m],m++});let o=.0075/a;this.el.setAttribute("geometry",{primitive:"plane",width:j*o,height:k*o}),this.el.removeAttribute("material"),this.el.setAttribute("material",{src:"#"+this.canvas.id.toString(),shader:"flat",npot:!0,transparent:!0})}},remove:function(){this.el.innerHTML=""}})})();
