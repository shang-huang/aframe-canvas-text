(function(){'use strict';if("undefined"==typeof AFRAME)throw new Error("Canvas-text need AFRAME to work.");AFRAME.registerComponent("canvas-text",{schema:{value:{type:"string"},size:{type:"int",default:50},color:{type:"color",default:"black"},align:{type:"string",default:"left",oneOf:["left","center","right"]}},init:function(){this.canvas=document.createElement("canvas"),this.canvas.id=this.el.object3D.uuid,this.canvas.style.display="none",this.el.appendChild(this.canvas),this.context=this.canvas.getContext("2d")},update:function(a){if(a!=this.data){let a=this.el,b=this.canvas,c=this.context,d=window.devicePixelRatio,e=window.getComputedStyle(document.body,null).getPropertyValue("font-family"),f=this.data.size*d+"px "+e,g=this.data.value.split("\\u"),h="";g.forEach((a,b)=>{if(0<b){let c=a.substring(0,4);h+=String.fromCharCode(parseInt(c,16))+a.substring(4,g[b].length)}});let i=g[0]+h,j=i.replace(/\\n/g,"\n").split("\n"),k=document.createElement("div");k.style.display="inline-block",j.forEach(a=>{let b=document.createElement("span");b.style.font=f,b.innerText=a,k.appendChild(b);let c=document.createElement("br");c.style.lineHeight=0,k.appendChild(c)}),document.body.appendChild(k);let l=k.offsetWidth,m=k.offsetHeight,n=[];k.childNodes.forEach(a=>{"span"===a.nodeName.toLowerCase()&&n.push(a.offsetHeight)}),document.body.removeChild(k),b.width=l,b.height=m,c.clearRect(0,0,l,m),c.font=f,c.textBaseline="middle",c.fillStyle=this.data.color;let o=0;j.forEach((a,b)=>{let d=n[b]/2+o;switch(this.data.align){case"left":c.textAlign="left",c.fillText(a,0,d);break;case"center":c.textAlign="center",c.fillText(a,l/2,d);break;case"right":c.textAlign="right",c.fillText(a,l,d);break;default:c.textAlign="left",c.fillText(a,0,d);}o+=n[b]});let p=.0075/d;a.setAttribute("geometry",{primitive:"plane",width:l*p,height:m*p}),a.removeAttribute("material"),a.setAttribute("material",{src:"#"+b.id.toString(),shader:"flat",npot:!0,transparent:!0})}},remove:function(){this.el.innerHTML=""}})})();
